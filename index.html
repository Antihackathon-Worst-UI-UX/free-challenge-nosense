<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>AntiHackatón</title>
</head>
<body>
    <header>
        <h1>NoSense Page</h1>
    </header>
    <main class="login-container">
        <form class="login-form" id="loginForm">
            <h2>Iniciar Sesión</h2>
            <label for="usuario">Usuario</label>
            <input type="text" id="usuario" name="usuario" placeholder="Ingrese su nombre o correo" required>
            <label for="clave">Contraseña</label>
            <input type="password" id="clave" name="clave" placeholder="Ingrese su contraseña" required>
            <button type="submit">Iniciar Sesión</button>
        </form>

        <form class="login-form" id="registroForm" style="display:none;">
            <h2>Registro</h2>
        
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre" readonly>
            <div id="tecladoNombre" class="teclado"></div>
        
            <label for="correo">Correo</label>
            <input type="email" id="correo" name="correo" placeholder="Ingrese su correo" required>
            <div id="tecladoCorreo" class="teclado"></div>

            <label for="claveRegistro">Contraseña</label>
            <input type="password" id="claveRegistro" name="claveRegistro" placeholder="Ingrese su contraseña" required>
            <div id="tecladoClave" class="teclado"></div>

            <h3>Fecha de nacimiento</h3>
            <div class="fecha">
              <label>Día:</label>
              <span id="dia">0</span>
              <button type="button" onclick="incrementar('dia')">+</button>
            </div>
            <div class="fecha">
              <label>Mes:</label>
              <span id="mes">0</span>
              <button type="button" onclick="incrementar('mes')">+</button>
            </div>
            <div class="fecha">
              <label>Año:</label>
              <span id="anio">0</span>
              <button type="button" onclick="incrementar('anio')">+</button>
            </div>
        
            <button id="btnRegistro">Registrarse</button>
        </form>

        <div id="mensaje"></div>
    </main>

    <div id="modal" class="modal">
        <div class="modal-content">
            <img src="src/sus-dog.gif" alt="Registro obligatorio" style="width:100%; border-radius:8px;">
            <p>Debes registrarte antes de iniciar sesión</p>
            <button id="registroBtn">Ir a Registro</button>
        </div>
    </div>

    <div id="captchaModal" class="modal">
        <div class="modal-content">
            <p style="font-size:1.1em;">Demuestre que no es un robot: cuente de 1 a 100 en voz alta.</p>
            <div style="display:flex; gap:8px; justify-content:center;">
                <button id="captchaListoBtn">Listo</button>
                <button id="captchaCancelarBtn" style="background-color:gray;">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
    window.addEventListener('load', function() {
        setTimeout(() => {
            document.getElementById('modal').style.display = 'flex';
        }, 3000);
    });

    document.getElementById('registroBtn').addEventListener('click', function() {
        document.getElementById('modal').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registroForm').style.display = 'block';
        inicializarTeclados();
    });

    function crearTeclado(letras, contenedorId, inputId) {
        const contenedor = document.getElementById(contenedorId);
        const input = document.getElementById(inputId);
        letras = letras.split("");
        letras.sort(() => Math.random() - 0.5);
    
        let mayusculas = true; 

        const shiftBtn = document.createElement("button");
        shiftBtn.innerText = "Shift";
        shiftBtn.style.backgroundColor = "orange";
        shiftBtn.addEventListener("click", (e) => {
            e.preventDefault();
            mayusculas = !mayusculas;
            actualizarTeclas();
        });
        contenedor.appendChild(shiftBtn);
    
        const borrarBtn = document.createElement("button");
        borrarBtn.innerText = "Borrar";
        borrarBtn.style.backgroundColor = "red";
        borrarBtn.addEventListener("click", (e) => {
            e.preventDefault();
            input.value = input.value.slice(0, -1);
        });
        contenedor.appendChild(borrarBtn);
 
        const botones = [];
        letras.forEach(letra => {
            const btn = document.createElement("button");
            btn.innerText = mayusculas ? letra.toUpperCase() : letra.toLowerCase();
            btn.style.setProperty("--rand", Math.random());
            btn.addEventListener("click", (e) => {
                e.preventDefault();
                input.value += mayusculas ? letra.toUpperCase() : letra.toLowerCase();
            });
            botones.push(btn);
            contenedor.appendChild(btn);
        });
    
        function actualizarTeclas() {
            letras.forEach((letra, i) => {
                botones[i].innerText = mayusculas ? letra.toUpperCase() : letra.toLowerCase();
            });
        }
        actualizarTeclas();
    }    

    function inicializarTeclados() {
        document.getElementById("tecladoNombre").innerHTML = "";
        document.getElementById("tecladoCorreo").innerHTML = "";
        document.getElementById("tecladoClave").innerHTML = "";

        crearTeclado("ABCDEFGHIJKLMNOPQRSTUVWXYZ", "tecladoNombre", "nombre");
        crearTeclado("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@._", "tecladoCorreo", "correo");
        crearTeclado("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()", "tecladoClave", "claveRegistro");
    }
    
    function incrementar(campo) {
        let valor = parseInt(document.getElementById(campo).innerText);
        valor++;
        document.getElementById(campo).innerText = valor;
    }
     
    function validarCampos() {
        const correo = document.getElementById("correo").value.trim();
        const clave = document.getElementById("claveRegistro").value.trim();
        const dia = parseInt(document.getElementById("dia").innerText);
        const mes = parseInt(document.getElementById("mes").innerText);
        const anio = parseInt(document.getElementById("anio").innerText);

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(correo)) {
            alert("Por favor ingresa un correo válido");
            return false;
        }
        if (clave.length < 6) {
            alert("La contraseña debe tener al menos 6 caracteres");
            return false;
        }
        if ( 31 < dia <= 0 || 12 < mes <= 0 || 2025 < anio <= 0) {
            alert("Por favor ingresa tu fecha de nacimiento completa");
            return false;
        }
        return true;
    }

    const captchaModal = document.getElementById("captchaModal");
    const captchaListoBtn = document.getElementById("captchaListoBtn");
    const captchaCancelarBtn = document.getElementById("captchaCancelarBtn");

    function mostrarCaptcha() {
        captchaModal.style.display = "flex";
    }
    function ocultarCaptcha() {
        captchaModal.style.display = "none";
    }

    const btnReg = document.getElementById("btnRegistro");

    btnReg.addEventListener("click", (e)=> {
        e.preventDefault();
        if (!validarCampos()) return; 
        mostrarCaptcha();
    });

    captchaListoBtn.addEventListener("click", () => {
        ocultarCaptcha();
        startRebote();
    });
    captchaCancelarBtn.addEventListener("click", ocultarCaptcha);

    function startRebote() {
        btnReg.disabled = true;
        const originalRect = btnReg.getBoundingClientRect();
        btnReg.style.position = "fixed";
        let x = originalRect.left;
        let y = originalRect.top;
        let vx = 5;
        let vy = 5;
        const ancho = window.innerWidth - btnReg.offsetWidth;
        const alto = window.innerHeight - btnReg.offsetHeight;
        let startTime = Date.now();
        let rebotes = 0;

        function rebotar() {
            let tiempo = Date.now() - startTime;
            if (x <= 0 || x >= ancho) vx *= -1;
            if (y <= 0 || y >= alto) vy *= -1;
            x += vx;
            y += vy;
            btnReg.style.left = x + "px";
            btnReg.style.top = y + "px";

            if (tiempo < 3000){
                requestAnimationFrame(rebotar);
            } else {
                rebotes++;
                if (rebotes < 3){
                    startTime = Date.now();
                    requestAnimationFrame(rebotar);
                } else {
                    btnReg.style.position = "";
                    btnReg.style.left = "";
                    btnReg.style.top = "";
                    btnReg.disabled = false;
                    guardarRegistro();
                }
            }
        }
        rebotar();
    }

    function guardarRegistro() {
        const nombre = document.getElementById("nombre").value.trim();
        const correo = document.getElementById("correo").value.trim();
        const clave = document.getElementById("claveRegistro").value.trim();
      
        localStorage.setItem("usuarioRegistrado", JSON.stringify({
          nombre: nombre,
          correo: correo,
          clave: clave
        }));
      
        alert("Registro guardado. Ahora puedes iniciar sesión.");
      
        document.getElementById("registroForm").style.display = "none";
        document.getElementById("loginForm").style.display = "block";
    }

    document.getElementById("loginForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const usuarioIngresado = document.getElementById("usuario").value.trim();
        const claveIngresada = document.getElementById("clave").value.trim();
        const datos = JSON.parse(localStorage.getItem("usuarioRegistrado"));
        if (!datos) {
            alert("No hay ningún usuario registrado. Regístrate primero.");
            return;
        }
        if ((usuarioIngresado === datos.nombre || usuarioIngresado === datos.correo) && claveIngresada === datos.clave) {
            alert("Inicio de sesión exitoso. ¡Bienvenido " + datos.nombre + "!");

        } else {
            alert("Usuario o contraseña incorrectos.");
        }
    });
    </script>
</body>
</html>
